import{E as B,D as G,r as V,A as a,B as p}from"./index-DCxQT9AF.js";import{t as v,c as J,m as Y,a as R,d as W,s as K,f as q}from"./format-CUpG5mvb.js";function Q(s,e){const t=v(s);return isNaN(e)?J(s,NaN):(e&&t.setDate(t.getDate()+e),t)}function X(s,e){const t=e*7;return Q(s,t)}function ee(s,e){const t=e==null?void 0:e.weekStartsOn,n=v(s),l=n.getDay(),o=(l<t?-7:0)+6-(l-t);return n.setDate(n.getDate()+o),n.setHours(23,59,59,999),n}function te(s,e){const t=v(s),n=v(e);return+t<+n}function k(s,e){const n=re(s);let l;if(n.date){const u=le(n.date,2);l=ie(u.restDateString,u.year)}if(!l||isNaN(l.getTime()))return new Date(NaN);const o=l.getTime();let g=0,x;if(n.time&&(g=oe(n.time),isNaN(g)))return new Date(NaN);if(n.timezone){if(x=de(n.timezone),isNaN(x))return new Date(NaN)}else{const u=new Date(o+g),f=new Date(0);return f.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),f.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),f}return new Date(o+g+x)}const D={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},se=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ae=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ne=/^([+-])(\d{2})(?::?(\d{2}))?$/;function re(s){const e={},t=s.split(D.dateTimeDelimiter);let n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],D.timeZoneDelimiter.test(e.date)&&(e.date=s.split(D.timeZoneDelimiter)[0],n=s.substr(e.date.length,s.length))),n){const l=D.timezone.exec(n);l?(e.time=n.replace(l[1],""),e.timezone=l[1]):e.time=n}return e}function le(s,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=s.match(t);if(!n)return{year:NaN,restDateString:""};const l=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?l:o*100,restDateString:s.slice((n[1]||n[2]).length)}}function ie(s,e){if(e===null)return new Date(NaN);const t=s.match(se);if(!t)return new Date(NaN);const n=!!t[4],l=j(t[1]),o=j(t[2])-1,g=j(t[3]),x=j(t[4]),u=j(t[5])-1;if(n)return ge(e,x,u)?ce(e,x,u):new Date(NaN);{const f=new Date(0);return!me(e,o,g)||!xe(e,l)?new Date(NaN):(f.setUTCFullYear(e,o,Math.max(l,g)),f)}}function j(s){return s?parseInt(s):1}function oe(s){const e=s.match(ae);if(!e)return NaN;const t=U(e[1]),n=U(e[2]),l=U(e[3]);return he(t,n,l)?t*Y+n*R+l*1e3:NaN}function U(s){return s&&parseFloat(s.replace(",","."))||0}function de(s){if(s==="Z")return 0;const e=s.match(ne);if(!e)return 0;const t=e[1]==="+"?-1:1,n=parseInt(e[2]),l=e[3]&&parseInt(e[3])||0;return fe(n,l)?t*(n*Y+l*R):NaN}function ce(s,e,t){const n=new Date(0);n.setUTCFullYear(s,0,4);const l=n.getUTCDay()||7,o=(e-1)*7+t+1-l;return n.setUTCDate(n.getUTCDate()+o),n}const ue=[31,null,31,30,31,30,31,31,30,31,30,31];function z(s){return s%400===0||s%4===0&&s%100!==0}function me(s,e,t){return e>=0&&e<=11&&t>=1&&t<=(ue[e]||(z(s)?29:28))}function xe(s,e){return e>=1&&e<=(z(s)?366:365)}function ge(s,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function he(s,e,t){return s===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&s>=0&&s<25}function fe(s,e){return e>=0&&e<=59}function pe(s,e){return X(s,-e)}const be={low:"bg-emerald-400",medium:"bg-amber-400",high:"bg-rose-500"},O=["high","medium","low"],ke=()=>{const{tasks:s,columns:e}=B(),{t,i18n:n}=G(),l=new Date,{totalTasks:o,completedTasks:g,completionRate:x,dueSoon:u,overdue:f,statusStats:_,priorityStats:T,upcomingDeadlines:M,weeklyVelocity:C}=V.useMemo(()=>{const r=s.length,d=s.filter(i=>i.status==="done").length,c=r===0?0:Math.round(d/r*100),h=s.filter(i=>{const m=k(i.dueDate),b=W(m,l);return i.status!=="done"&&b>=0&&b<=7}).length,w=s.filter(i=>{const m=k(i.dueDate);return i.status!=="done"&&te(m,l)}).length,S=e.map(i=>({id:i.id,label:i.translationKey,total:s.filter(m=>m.status===i.id).length})),y=O.map(i=>({id:i,total:s.filter(m=>m.priority===i).length})),$=[...s].filter(i=>i.status!=="done").sort((i,m)=>k(i.dueDate).getTime()-k(m.dueDate).getTime()).slice(0,5),P=Array.from({length:6}).map((i,m)=>{const b=K(pe(l,5-m),{weekStartsOn:1}),H=ee(b,{weekStartsOn:1}),A=s.filter(L=>{const I=k(L.createdAt);return I>=b&&I<=H}).length;return{label:q(b,"MMM d"),count:A}});return{totalTasks:r,completedTasks:d,completionRate:c,dueSoon:h,overdue:w,statusStats:S,priorityStats:y,upcomingDeadlines:$,weeklyVelocity:P}},[s,e,l]),N=T.reduce((r,d)=>r+d.total,0),E=N===0?"conic-gradient(#e2e8f0 0deg 360deg)":(()=>{let r=0;const d=[];return O.forEach(c=>{const h=T.find(P=>P.id===c);if(!h||h.total===0)return;const w=h.total/N*360,S=r,y=r+w;r=y;const $=c==="high"?"#f43f5e":c==="medium"?"#f59e0b":"#10b981";d.push(`${$} ${S}deg ${y}deg`)}),`conic-gradient(${d.join(", ")})`})(),F=Math.max(...C.map(r=>r.count),1),Z=n.language==="ar"?"ar-EG":n.language==="ru"?"ru-RU":"en-US";return a.jsxs(p.section,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.35,ease:"easeOut"},className:"space-y-6",children:[a.jsxs("div",{className:"glass-panel rounded-3xl p-6",children:[a.jsx("h1",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100",children:t("statisticsPage.title")}),a.jsx("p",{className:"mt-2 max-w-3xl text-sm text-slate-500 dark:text-slate-300",children:t("statisticsPage.subtitle")})]}),a.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[{label:t("statisticsPage.cards.total"),value:o,accent:"from-sky-500 to-indigo-500"},{label:t("statisticsPage.cards.completed"),value:`${g} · ${x}%`,accent:"from-emerald-500 to-teal-500"},{label:t("statisticsPage.cards.dueSoon"),value:u,accent:"from-amber-500 to-orange-500"},{label:t("statisticsPage.cards.overdue"),value:f,accent:"from-rose-500 to-pink-500"}].map(r=>a.jsxs(p.div,{whileHover:{translateY:-4},className:"relative overflow-hidden rounded-3xl bg-white/80 p-5 shadow-lg shadow-slate-200/50 ring-1 ring-white/50 backdrop-blur-xl dark:bg-slate-900/70 dark:shadow-slate-900/40 dark:ring-slate-800/60",children:[a.jsx("div",{className:`absolute -right-6 -top-6 h-24 w-24 rounded-full bg-gradient-to-br ${r.accent} opacity-20`}),a.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-300",children:r.label}),a.jsx("p",{className:"mt-3 text-3xl font-semibold text-slate-900 dark:text-white",children:r.value})]},r.label))}),a.jsxs("div",{className:"grid gap-6 xl:grid-cols-3",children:[a.jsxs(p.div,{layout:!0,className:"space-y-4 rounded-3xl bg-white/85 p-6 shadow-lg shadow-slate-200/50 ring-1 ring-white/40 backdrop-blur-xl dark:bg-slate-900/70 dark:shadow-slate-900/40 dark:ring-slate-800/60 xl:col-span-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("statisticsPage.sections.progress")}),a.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-500 dark:bg-slate-800 dark:text-slate-300",children:[x,"% ",t("statisticsPage.labels.completion")]})]}),a.jsx("div",{className:"space-y-4",children:_.map(r=>{const d=t(r.label),c=o===0?0:Math.round(r.total/o*100);return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-500 dark:text-slate-300",children:[a.jsx("span",{children:d}),a.jsxs("span",{children:[r.total," · ",c,"%"]})]}),a.jsx("div",{className:"mt-2 h-3 w-full rounded-full bg-slate-100 dark:bg-slate-800",children:a.jsx(p.div,{initial:{width:0},animate:{width:`${c}%`},transition:{duration:.6,ease:"easeOut"},className:"h-full rounded-full bg-gradient-to-r from-accent-light to-blue-400 dark:from-accent-dark dark:to-sky-500"})})]},r.id)})})]}),a.jsxs(p.div,{layout:!0,className:"space-y-5 rounded-3xl bg-white/85 p-6 shadow-lg shadow-slate-200/50 ring-1 ring-white/40 backdrop-blur-xl dark:bg-slate-900/70 dark:shadow-slate-900/40 dark:ring-slate-800/60",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("statisticsPage.sections.priority")}),a.jsxs("div",{className:"flex items-center justify-between gap-6",children:[a.jsx("div",{className:"h-36 w-36 rounded-full border-4 border-white/60 shadow-lg shadow-slate-200/60 dark:border-slate-800/80",style:{backgroundImage:E},children:a.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full bg-white/80 text-center text-sm font-semibold text-slate-700 shadow-inner shadow-white/40 dark:bg-slate-900/80 dark:text-slate-100 dark:shadow-slate-900/40",children:N===0?t("statisticsPage.labels.noData"):`${x}%`})}),a.jsx("div",{className:"flex-1 space-y-3",children:O.map(r=>{const d=T.find(w=>w.id===r),c=(d==null?void 0:d.total)??0,h=N===0?0:Math.round(c/N*100);return a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`h-2 w-2 rounded-full ${be[r]}`}),a.jsx("span",{className:"font-medium text-slate-600 capitalize dark:text-slate-200",children:t(`labels.priorityLevels.${r}`)})]}),a.jsxs("span",{className:"text-slate-500 dark:text-slate-300",children:[c," · ",h,"%"]})]},r)})})]})]})]}),a.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[a.jsxs(p.div,{layout:!0,className:"space-y-5 rounded-3xl bg-white/85 p-6 shadow-lg shadow-slate-200/50 ring-1 ring-white/40 backdrop-blur-xl dark:bg-slate-900/70 dark:shadow-slate-900/40 dark:ring-slate-800/60",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("statisticsPage.sections.velocity")}),a.jsx("span",{className:"text-xs font-medium text-slate-400 dark:text-slate-300",children:t("statisticsPage.labels.lastWeeks",{count:C.length})})]}),a.jsx("div",{className:"flex h-48 items-end gap-3",children:C.map(r=>a.jsxs("div",{className:"flex flex-1 flex-col items-center gap-2",children:[a.jsx(p.div,{initial:{height:0},animate:{height:`${r.count/F*100}%`},transition:{duration:.5,ease:"easeOut"},className:"w-full rounded-2xl bg-gradient-to-t from-slate-200 to-accent-light/80 shadow-lg dark:from-slate-800 dark:to-accent-dark/70"}),a.jsx("span",{className:"text-xs font-medium text-slate-400 dark:text-slate-400",children:r.label}),a.jsx("span",{className:"text-xs font-semibold text-slate-500 dark:text-slate-300",children:r.count})]},r.label))})]}),a.jsxs(p.div,{layout:!0,className:"space-y-5 rounded-3xl bg-white/85 p-6 shadow-lg shadow-slate-200/50 ring-1 ring-white/40 backdrop-blur-xl dark:bg-slate-900/70 dark:shadow-slate-900/40 dark:ring-slate-800/60",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("statisticsPage.sections.upcoming")}),a.jsx("div",{className:"space-y-4",children:M.length===0?a.jsx("p",{className:"rounded-2xl border border-dashed border-slate-200/70 p-6 text-center text-sm text-slate-400 dark:border-slate-700/70 dark:text-slate-500",children:t("statisticsPage.labels.noUpcoming")}):M.map(r=>{const d=new Date(r.dueDate),c=W(d,l),h=r.priority==="high"?"bg-rose-500/15 text-rose-500":r.priority==="medium"?"bg-amber-500/15 text-amber-500":"bg-emerald-500/15 text-emerald-500";return a.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-100/70 bg-white/80 px-4 py-3 shadow-sm shadow-slate-200/50 dark:border-slate-800/70 dark:bg-slate-900/70 dark:shadow-slate-900/40",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:r.title}),a.jsxs("p",{className:"text-xs text-slate-400 dark:text-slate-400",children:[r.description.slice(0,72),r.description.length>72?"...":""]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("span",{className:`inline-flex items-center justify-center rounded-full px-3 py-1 text-xs font-semibold ${h}`,children:t(`labels.priorityLevels.${r.priority}`)}),a.jsx("p",{className:"mt-2 text-xs font-medium text-slate-500 dark:text-slate-300",children:c<0?t("statisticsPage.labels.overdue",{count:Math.abs(c)}):c===0?t("statisticsPage.labels.dueToday"):t("statisticsPage.labels.dueIn",{count:c})}),a.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500",children:d.toLocaleDateString(Z,{month:"short",day:"numeric",year:"numeric"})})]})]},r.id)})})]})]})]})};export{ke as default};
